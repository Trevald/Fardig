<template>
	<button @click="doCommand" class="no-style" :class="{ 'is-active': thisIsActive }" ref="button">
		<svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg" v-html="icon"></svg>
	</button>
</template>

<script>
	import tippy from "tippy.js"

	export default {
		name: "AppEditorMenuButton",

		props: {
			commands: Object,
			isActive: Object,
			name: String,
		},

		data() {
			return {
				headings: ["h1", "h2", "h3"],
				icons: {
					h1:
						'<path d="M3.75 27.75H11.1533V26.2414H9.1139V18.5867H17.9699V26.2414H15.9305V27.75H23.3338V26.2414H21.2944V9.75859H23.3338V8.25H15.9305V9.75859H17.9699V16.9384H9.1139V9.75859H11.1533V8.25H3.75V9.75859H5.7894V26.2414H3.75V27.75Z"/><path d="M27.8685 27.75H29.6608V26.9764V18.75H28.2425L25.38 20.2199L25.6766 20.8904L27.8685 20.0523V26.9764V27.75Z"/>',
					h2:
						'<path d="M3.75 27.75H11.1533V26.2414H9.1139V18.5867H17.9699V26.2414H15.9305V27.75H23.3338V26.2414H21.2944V9.75859H23.3338V8.25H15.9305V9.75859H17.9699V16.9384H9.1139V9.75859H11.1533V8.25H3.75V9.75859H5.7894V26.2414H3.75V27.75Z" /><path d="M25.365 27.75H30.9889V26.4254H30.222H26.5386V26.3789L28.6534 24.7173C29.734 23.8806 30.7101 23.0673 30.7101 21.731C30.7101 20.325 29.6759 19.5 27.8981 19.5C26.3875 19.5 25.4463 20.1972 25.4463 21.0338C25.4463 21.5915 25.7949 21.9634 26.3294 21.9634C26.8756 21.9634 27.1893 21.5799 27.1893 21.0919C27.1893 20.7782 27.0034 20.4877 26.7594 20.3831V20.325C26.9569 20.232 27.2474 20.1739 27.596 20.1739C28.4326 20.1739 28.9787 20.6852 28.9787 21.6032V21.9169C28.9787 22.8 28.4907 23.5204 27.7703 24.2408L25.365 26.6229V27.75Z" />',
					h3:
						'<path d="M3.75 27.75H11.1533V26.2414H9.1139V18.5867H17.9699V26.2414H15.9305V27.75H23.3338V26.2414H21.2944V9.75859H23.3338V8.25H15.9305V9.75859H17.9699V16.9384H9.1139V9.75859H11.1533V8.25H3.75V9.75859H5.7894V26.2414H3.75V27.75Z" /><path d="M28.4828 27.9C30.2695 27.9 31.2564 27.069 31.2564 25.7809C31.2564 24.6486 30.2799 24.1084 29.3034 23.9734V23.9215C30.2176 23.7864 31.1421 23.1216 31.1421 22.1763C31.1421 21.0025 30.2072 20.4 28.5867 20.4C27.1739 20.4 26.3845 21.044 26.3845 21.7712C26.3845 22.2698 26.6961 22.6022 27.1739 22.6022C27.6622 22.6022 27.9426 22.2594 27.9426 21.8231C27.9426 21.5427 27.7764 21.283 27.5583 21.1895V21.1375C27.7349 21.0544 28.0257 21.0025 28.3582 21.0025C29.0957 21.0025 29.5943 21.418 29.5943 22.1659V22.4568C29.5943 23.1528 29.1476 23.6306 28.1504 23.6306H27.4752V24.3266H28.1712C29.2203 24.3266 29.7086 24.7837 29.7086 25.6458V25.9886C29.7086 26.9235 29.1892 27.2975 28.2127 27.2975C27.8907 27.2975 27.5895 27.2559 27.3713 27.1625V27.1105C27.5895 27.017 27.7557 26.7573 27.7557 26.4769C27.7557 26.0406 27.4752 25.6978 26.987 25.6978C26.5091 25.6978 26.1975 26.0302 26.1975 26.5288C26.1975 27.2663 27.0389 27.9 28.4828 27.9Z"/>',
					bullet_list:
						'<rect x="11.25" y="6.75" width="21.75" height="2.25" /><rect x="3" y="6.75" width="3.75" height="2.25" /><rect x="11.25" y="16.5" width="21.75" height="2.25"/><rect x="3" y="16.5" width="3.75" height="2.25" /><rect x="11.25" y="26.25" width="21.75" height="2.25"/><rect x="3" y="26.25" width="3.75" height="2.25" />',
					ordered_list:
						'<rect x="13.5" y="6.75" width="19.5" height="2.25" /><rect x="13.5" y="16.5" width="19.5" height="2.25" /><rect x="13.5" y="26.25" width="19.5" height="2.25" /><path d="M7.49151 11.25V10.161V4.96799H5.42151L3.91851 6.94799L4.78251 7.62299L6.06051 5.94899H6.14151V10.161V11.25H7.49151Z"/><path d="M8.56251 19.866H5.59251L6.76251 18.948C7.66251 18.237 8.43651 17.58 8.43651 16.5C8.43651 15.411 7.65351 14.61 6.29451 14.61C4.98951 14.61 4.26051 15.339 3.98151 16.212L5.16051 16.662C5.28651 16.185 5.57451 15.78 6.16851 15.78C6.57351 15.78 6.99651 16.023 6.99651 16.5V16.626C6.99651 17.157 6.75351 17.508 6.05151 18.111L4.11651 19.767V21H8.56251V19.866Z" /><path d="M5.37651 26.952V28.077H5.94351C6.62751 28.077 7.04151 28.338 7.04151 28.851V28.905C7.04151 29.427 6.68151 29.76 6.06951 29.76C5.39451 29.76 5.01651 29.391 4.74651 28.878L3.74751 29.652C4.15251 30.291 4.79151 30.858 6.06951 30.858C7.49151 30.858 8.45451 30.129 8.45451 29.004C8.45451 28.14 7.89651 27.627 7.14951 27.492V27.438C7.79751 27.321 8.34651 26.826 8.34651 26.025C8.34651 25.017 7.47351 24.36 6.12351 24.36C5.04351 24.36 4.43151 24.792 3.95451 25.413L4.80051 26.205C5.11551 25.728 5.57451 25.458 6.07851 25.458C6.60951 25.458 6.92451 25.764 6.92451 26.214V26.277C6.92451 26.664 6.62751 26.952 5.96151 26.952H5.37651Z"/>',
					todo_list:
						'<rect x="13.5" y="6.75" width="19.5" height="2.25" /><path d="M9.75 5.3937L8.74148 4.5L5.70722 8.5378L3.79551 6.93496L3 8.05382L5.91756 10.5L6.03869 10.3296L6.03997 10.3308L9.75 5.3937Z" /><path d="M9.75 15.1437L8.74148 14.25L5.70722 18.2878L3.79551 16.685L3 17.8038L5.91756 20.25L6.03869 20.0796L6.03997 20.0808L9.75 15.1437Z"/><path d="M9.75 24.8937L8.74148 24L5.70722 28.0378L3.79551 26.435L3 27.5538L5.91756 30L6.03869 29.8296L6.03997 29.8308L9.75 24.8937Z" /><rect x="13.5" y="16.5" width="19.5" height="2.25" /><rect x="13.5" y="26.25" width="19.5" height="2.25" />',
					blockquote:
						'<path d="M19.225 26.0556H22.6083C25.875 23.5025 28.5 18.9309 28.5 15.2498V14.6561C28.5 12.3405 27.0417 10.5 24.5917 10.5C22.2 10.5 20.625 12.2812 20.625 14.4186V14.7748C20.625 16.7935 22.025 18.5153 24.2417 18.5153H24.3583C23.775 20.9495 21.9083 23.6807 19.225 26.0556ZM7.5 26.0556H10.8833C14.15 23.5025 16.775 18.9309 16.775 15.2498V14.6561C16.775 12.3405 15.3167 10.5 12.8667 10.5C10.475 10.5 8.9 12.2812 8.9 14.4186V14.7748C8.9 16.7935 10.3 18.5153 12.5167 18.5153H12.6333C12.05 20.9495 10.1833 23.6807 7.5 26.0556Z"/>',
					em:
						'<path d="M12.75 27.75H19.176L19.473 26.535H17.583L21.687 10.119H23.577L23.874 8.90399H17.448L17.151 10.119H19.041L14.937 26.535H13.047L12.75 27.75Z" />',
					strong:
						'<path d="M9.84147 27.75H19.9935C23.8815 27.75 26.0415 25.806 26.0415 22.512C26.0415 19.542 23.4765 18.111 21.3705 17.895V17.76C23.3955 17.355 25.2855 15.978 25.2855 13.332C25.2855 10.767 23.3685 8.90399 19.3725 8.90399H9.84147V10.524H11.7585V26.13H9.84147V27.75ZM15.5385 18.948H19.0215C21.0195 18.948 22.1535 20.055 22.1535 21.864V23.079C22.1535 24.888 21.0195 25.995 19.0215 25.995H15.5385V18.948ZM15.5385 10.659H18.5625C20.4255 10.659 21.3975 11.631 21.3975 13.332V14.52C21.3975 16.221 20.4255 17.193 18.5625 17.193H15.5385V10.659Z"/>',
				},
			}
		},

		computed: {
			thisIsActive() {
				if (this.isHeading) {
					return this.isActive.heading({ level: this.name.substring(1, 2) })
				} else {
					return this.isActive[this.name]()
				}
			},

			icon() {
				return this.icons[this.name]
			},

			isHeading() {
				return this.headings.includes(this.name)
			},
		},

		methods: {
			doCommand() {
				if (this.isHeading) {
					this.commands.heading({ level: this.name.substring(1, 2) })
				} else {
					this.commands[this.name]()
				}
			},

			getTooltip() {
				const isMacLike = /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)
				const metaKey = isMacLike ? "⌘" : "⊞ Win"

				switch (this.name) {
					case "blockquote":
						return "^ + >"
					case "h1":
						return "^ + ⇧ + 1"
					case "h2":
						return "^ + ⇧ + 2"
					case "h3":
						return "^ + ⇧ + 3"
					case "strong":
						return `${metaKey} + B`
					case "em":
						return `${metaKey} + I`
					case "bullet_list":
						return `^ + ⇧ + 8`
					case "ordered_list":
						return `^ + ⇧ + 9`
					case "todo_list":
						return `^ + T`
					default:
						return undefined
				}
			},
		},

		mounted() {
			const tooltip = this.getTooltip()
			if (tooltip !== undefined) {
				tippy(this.$refs.button, {
					content: tooltip,
					delay: [250, 100],
					duration: [250, 100],
				})
			}
		},
	}
</script>
